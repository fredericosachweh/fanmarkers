{% extends "base.html" %}
{% load humanize %}

{%block title%}{{c.name}}{% endblock %}

{% block css %}
<style type="text/css">
	.alert			{color: darkred; font-weight: bold}
	
	.edit_link img		{border: 0px solid black}
	
	.operation_box		{border: 3px solid black; margin: 1em; padding: 1em; font-size: medium}
	
	.position_box		{border: 1px solid black; margin-bottom: .5em; padding: .5em; font-size: medium}
	.position_status	{font-size: medium}
	.position_name		{font-size: x-large; font-weight: bold}
	.payscale		{border-collapse: collapse; font-size: medium; margin-top: 1em}
	.payscale td		{border: 1px solid gray;  padding: 3px}
	
	.position_mins		{margin-top: 1em; border-collapse: collapse}
	.position_mins td	{border: 0px solid black; padding-right: 1em}
	
	.fleet_box		{border: 1px solid black; margin-top: 0.5em; margin-bottom: 0.5em; background: lightgray; padding: .5em}

	
	.base			{border: 1px solid black; margin-top: 1em; padding: 0.5em; overflow: hidden}
	.base_link		{font-weight: bold}
	.base_info		{display: none}
	.base_floats		{float: left; padding-right: 1em}
	
	.b1			{background: gray}						/* not hiring */
	.b2			{background: lightblue}						/* hring */
	.b3			{background: red}						/* lay offs */
	.a1			{background: gold; border: 3px double green}			/* advertising */
	
	.hm0			{background: clear}
	.hm1			{background: lightgreen}
	.hm2			{background: lightgreen}
	.hm3			{background: lightblue}
	
	.plus			{cursor: pointer}
	
	.routes_table		{border-collapse: collapse; margin-top: 1em}
	.routes_table td	{padding-right: 2em}
	
</style>
{% endblock %}

{% block javascript %}

<script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key={{ GOOGLE_MAPS_KEY }}" type="text/javascript"></script>

<script>
	var icon = new GIcon;
	icon.image = '{{ MEDIA_URL }}/icons/big/red.png';
	icon.iconSize = new GSize(16,16);
	icon.iconAnchor = new GPoint(8,8);
	icon.infoWindowAnchor = new GPoint(16,16);

	var sicon = new GIcon;
	sicon.image = "{{ MEDIA_URL }}/icons/small/red.png";
	sicon.iconSize = new GSize(8,8);
	sicon.iconAnchor = new GPoint(4,4);
	sicon.infoWindowAnchor = new GPoint(8,8);

</script>

<script type="text/javascript" src="{{ MEDIA_URL }}/javascripts/small_map.js"></script>
<script type="text/javascript" src="{{ MEDIA_URL }}/javascripts/company_doc_ready.js"></script>

<script type="text/javascript">
	var bases = [];	//lat longs of all bases, indexed by the pk of that opbase
	var maps = [];	//array of the Gmap2 objects
	var data = [];	//array of all the points, indexed by the opbase pk
	
	var plus_path = '{{ MEDIA_URL }}/icons/plus.png';
	var minus_path = '{{ MEDIA_URL }}/icons/minus.png';
	
{% for op in c.operation_set.all %}{% for ob in op.opbase_set.all %}
	bases[{{ob.pk}}] = [{{ob.base.location.y}},{{ob.base.location.x}}]; 
	data[{{ob.pk}}] = {% if ob.routes.all %}{{ob.routes_json}}{%else%}"None";{% endif %}
{% endfor %}{% endfor %}

</script>
{% endblock %}

{% block body %}
	<div id="main_container">
	
		{% if not_found %}
		
			<h1>Company Does Not Exist</h1>
		
		{% endif %}
		
			{# ------------company info--------------------------------- #}
		
			<div id="top_title">
				{% if user.is_authenticated %}
				<a href="/edit/company/{{c.pk}}" class="edit_link"><img src="{{ MEDIA_URL }}/icons/edit.png" alt="edit" /></a>
				{% endif %}
				
				{{ c.name }}
			</div>
			{{ c.call_sign }}<br />
			{% if c.website %}
				<a href="{{c.website}}">{{c.website}}</a>
			{% endif %}
			
			
			
			{% for op in c.operation_set.all %}
			<div class="operation_box">
			
				{# ------------position box--------------------------------- #}
			
				{% for pos in op.positions.all %}
				<div class="position_box hm{{ pos.hiring_method }}">
					<div class="position_name">
						
						{{pos.name}}
						
						{% if forloop.first %}<a name="op{{op.pk}}"></a>{% endif %}
					
					</div>
					
					{% if pos.payscaleyear_set.all %}
						<table class="payscale">
							{% for ps in pos.payscaleyear_set.all %}
								{% if forloop.last and forloop.first %}
									<tr>
										<td>${{ ps.amount|floatformat:2|intcomma }} <small>{{ ps.get_salary_unit_display }}</small></td>
									</tr>
								{% else %}
									<tr>
										<td>{{ ps.year|ordinal }} year:</td>
										<td>${{ ps.amount|floatformat:2|intcomma }} <small>{{ ps.get_salary_unit_display }}</small></td>
									</tr>
								{% endif %}
							{% endfor %}
						
							{% if not pos.training_provided %}
								<tr>
									<td>
										<span> class="alert">** INITIAL TRAINING NOT PROVIDED **</span>
									</td>
								</tr>
							{% endif %}
						</table>
					{% endif %}
					
					<table class="position_mins">
						<tr>
							{% if pos.hard_mins %}
								<td>Hard Minimums:</td>
								{% for r in pos.hard_mins.display_hard %}
									{% if forloop.first %}
										<td>{{r|join:" "}}</td></tr>
									{% else %}
										<tr><td></td><td>{{r|join:" "}}</td></tr>
									{% endif %}
								{% endfor %}
							{% endif %}
					
							{% if pos.pref_mins %}
					
								<tr><td>&nbsp;</td></tr>
								<tr><td>Preferred:</td>
								{% for r in pos.pref_mins.display_pref %}
									{% if forloop.first %}
										<td>{{r|join:" "}}</td></tr>
									{% else %}
										<tr><td></td><td>{{r|join:" "}}</td></tr>
									{% endif %}
								{% endfor %}
								
								
							{% endif %}
							
							{% if not pos.pref_mins and not pos.hard_mins %}
								<td><em>No known hiring minimums</em></td></tr>
							{% endif %}
					</table>
				</div>
					
				{% endfor %}
				
				{# ------------fleet below---------------------------------- #}
					
				{% for f in op.fleet.all %}
					<div class="fleet_box">
						<a href="../../aircraft/{{ f.aircraft.type }}">{{ f.aircraft }}</a> ({{ f.size }})
					</div>
				{% endfor %}
				
				{# -------------bases below--------------------------------- #}
					
				{% for ob in op.opbase_set.all %}
					<div class="base b{{ ob.hiring_status }}">
						<div class="base_floats">
							<img title="Click to expand" class="plus" id="expand_{{ob.pk}}" src="{{ MEDIA_URL }}/icons/plus.png" alt="+"/>
						</div>
						<div class="base_floats">
							<a title="{{ ob.base.get_location }}" class="base_link" href="/airport/{{ ob.base.identifier }}">
								{{ ob.base.display_name }}</a> {{ ob.get_hiring_status_display }} ({{ob.workforce_size}})<br />
								<small>{{ ob.base.municipality }}, {{ ob.base.region }}{% ifnotequal ob.base.country "United States"%}, {{ ob.base.country }}{% endifnotequal %}</small>
							
							<div class="base_info" id="info_{{ob.pk}}" >
								<div id="map_{{ob.pk}}" class="small_map"></div>
							
							
								{% if ob.routes.all %}
									<table class="routes_table">
									{% for r in ob.routes.all %}		{# new row, new route #}
										<tr>
										{% if forloop.first %}
											<td>Routes:</td>
										{% else %}
											<td></td>
										{% endif %}
									
										<td>
										{{r.get_often_display}}
										<a href="/airport/{{ ob.base.identifier }}" title="{{ ob.base.city }}, {{ ob.base.sector }}">{{ ob.base.identifier }}</a> &#8594; 
										{% for b in r.routebase_set.all %}
										<a href="/airport/{{ b.base.identifier }}" title="{{ b.base.city }}, {{ b.base.sector }}">{{ b.base.identifier }}</a> &#8594; 
										{% if forloop.last%}
										<a href="/airport/{{ ob.base.identifier }}" title="{{ ob.base.city }}, {{ ob.base.sector }}">{{ ob.base.identifier }}</a>
										{% endif %}
										{% endfor%}
										</td>
										</tr>
									{% endfor %}
									</table>
								{% endif %}
							</div>
						</div>
					</div>
				{% endfor %}
				</div>			
			{% endfor %}

	</div>
{% endblock %}
